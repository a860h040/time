<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Model Fix Calculator â€” Copy Table / Drag Resize</title>
<style>
  :root{
    --bg:#0b0b0c; --card:#121214; --grid:#222; --text:#eaeaea; --muted:#a8a8a8;
    --fs:14px; --rowpad:10px;
  }
  *{box-sizing:border-box}
  html,body{margin:0;height:100%;background:var(--bg);color:var(--text);font-family:system-ui,Arial,sans-serif;font-size:var(--fs)}
  header{padding:12px 16px;border-bottom:1px solid var(--grid);background:#101013;position:sticky;top:0;z-index:2}
  h1{margin:0;font-size:18px}
  .sub{color:var(--muted);font-size:12px;margin-top:4px}
  .wrap{padding:16px;display:flex;flex-direction:column;gap:12px}

  .panel{display:flex;flex-wrap:wrap;gap:8px;align-items:end;padding:10px;border:1px solid var(--grid);
    border-radius:10px;background:var(--card)}
  .field{display:flex;flex-direction:column;gap:4px}
  .field label{font-size:12px;color:var(--muted)}
  .panel input[type="number"]{background:#151518;border:1px solid #2a2a2a;color:var(--text);padding:6px 8px;border-radius:8px;min-width:80px}
  .panel button{background:#1a1a1a;border:1px solid #2b2b2b;color:#ddd;padding:8px 12px;border-radius:8px;cursor:pointer}
  .panel button:hover{border-color:#4ea3ff}
  .panel .sep{width:1px;height:28px;background:#2a2a2a;margin:0 6px}

  /* Toast */
  .toast{position:fixed;right:16px;bottom:16px;background:#111;border:1px solid #2a2a2a;color:#eaeaea;
    padding:10px 12px;border-radius:10px;opacity:0;transform:translateY(8px);transition:.25s;pointer-events:none}
  .toast.show{opacity:1;transform:translateY(0)}

  /* Resizable frame with explicit handles */
  .sheet-frame{position:relative;display:inline-block;width:1000px;height:420px;min-width:480px;min-height:260px;
    border:1px solid var(--grid);border-radius:10px;background:var(--card);overflow:auto}
  .sheet{min-width:900px;border:1px solid var(--grid);border-radius:8px;background:#0f0f12}

  .resize-handle{position:absolute;background:transparent;z-index:5}
  .resize-right{top:0;right:0;width:10px;height:100%;cursor:ew-resize}
  .resize-bottom{left:0;bottom:0;width:100%;height:10px;cursor:ns-resize}
  .resize-corner{right:0;bottom:0;width:14px;height:14px;cursor:nwse-resize}
  .resize-corner::after{content:"";position:absolute;right:3px;bottom:3px;width:8px;height:8px;border-right:2px solid #2d2d2d;border-bottom:2px solid #2d2d2d}
  .resizing{user-select:none}

  table{border-collapse:collapse;width:100%}
  thead th{position:sticky;top:0;background:#17171a;border-bottom:1px solid var(--grid);padding:10px;text-align:left;font-weight:600;white-space:nowrap;position:relative}
  .col-resizer{position:absolute;top:0;right:0;width:6px;height:100%;cursor:col-resize;background:transparent}
  .col-resizer::after{content:"";position:absolute;inset:0 2px;border-right:2px solid #2d2d2d;opacity:.7}

  tbody td{border-top:1px solid var(--grid);padding:0}
  input.cell{width:100%;padding:var(--rowpad) 12px;background:transparent;border:none;outline:none;color:var(--text);font:inherit;text-align:right}
  input.cell.textcol{text-align:left}
  .ro{background:rgba(255,255,255,0.04);color:#dcdcdc}
  .opts{display:flex;gap:10px;align-items:center}
  .opts label{font-size:12px;color:#ccc;display:flex;gap:6px;align-items:center;user-select:none}
  .opts input[type="checkbox"]{transform:translateY(1px)}
</style>
</head>
<body>
<header>
  <h1>Model Fix Calculator</h1>
  <div class="sub">Plain text first column. Enter A and B; C/D/E compute automatically. Drag frame edges/corner to resize; drag header edges to resize columns. Copy the whole table with one click.</div>
</header>

<div class="wrap">
  <div class="panel">
    <div class="field"><label for="rows">Rows</label><input id="rows" type="number" value="7" min="1" step="1"></div>
    <button id="apply">Apply</button>
    <span class="sep"></span>
    <div class="opts">
      <label><input id="includeHdr" type="checkbox" checked> Include header</label>
      <label><input id="skipBlank" type="checkbox" checked> Skip fully blank rows</label>
    </div>
    <span class="sep"></span>
    <button id="copyTSV">Copy as TSV</button>
    <button id="copyCSV">Copy as CSV</button>
    <button id="copyHTML">Copy as HTML</button>
    <button id="clearAB">Clear A/B/C/D/E</button>
  </div>

  <div class="sheet-frame" id="frame">
    <div class="resize-handle resize-right"  data-axis="x"  title="Drag to resize width"></div>
    <div class="resize-handle resize-bottom" data-axis="y"  title="Drag to resize height"></div>
    <div class="resize-handle resize-corner" data-axis="xy" title="Drag to resize both"></div>

    <div class="sheet">
      <table id="grid" aria-label="Model Fix Grid">
        <thead>
          <tr>
            <th>Text <span class="col-resizer" data-col="1" title="Drag to resize column"></span></th>
            <th>Model 1 (A) <span class="col-resizer" data-col="2" title="Drag to resize column"></span></th>
            <th>Model 2 (B) <span class="col-resizer" data-col="3" title="Drag to resize column"></span></th>
            <th>Fix1 (C) <span class="col-resizer" data-col="4" title="Drag to resize column"></span></th>
            <th>Fix2 (D) <span class="col-resizer" data-col="5" title="Drag to resize column"></span></th>
            <th>Fix3 (E) <span class="col-resizer" data-col="6" title="Drag to resize column"></span></th>
          </tr>
        </thead>
        <tbody id="tbody"></tbody>
      </table>
    </div>
  </div>
</div>

<div class="toast" id="toast">Copied!</div>

<script>
(function(){
  const tbody   = document.getElementById('tbody');
  const rowsInp = document.getElementById('rows');
  const apply   = document.getElementById('apply');
  const clearAB = document.getElementById('clearAB');
  const table   = document.getElementById('grid');
  const copyTSV = document.getElementById('copyTSV');
  const copyCSV = document.getElementById('copyCSV');
  const copyHTML= document.getElementById('copyHTML');
  const includeHdr = document.getElementById('includeHdr');
  const skipBlank  = document.getElementById('skipBlank');
  const toast  = document.getElementById('toast');

  /* Math */
  const fmt = n => (isFinite(n) ? n.toFixed(6).replace(/\.?0+$/,'') : "");
  function compute(A,B){
    const C = 0.543*A + 0.457*B;
    const D = 12542.898914*A + 11420.962628*B
            - 109.512226*A*A - 113.529363*B*B
            - 673.234821*A*B
            - 2.044843*A*A*A - 0.046012*B*B*B
            + 8.490782*A*A*B + 4.692059*A*B*B
            - 212212.65665;
    const E = 0.964*A + 0.036*B - 0.695;
    return {C,D,E};
  }

  /* Rows */
  function rowEl(){
    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td><input class="cell textcol" type="text" placeholder="Text/Label"></td>
      <td><input class="cell a" type="number" step="any" placeholder="A" inputmode="decimal" aria-label="A"></td>
      <td><input class="cell b" type="number" step="any" placeholder="B" inputmode="decimal" aria-label="B"></td>
      <td><input class="cell ro c" type="text" placeholder="C" aria-label="C" readonly></td>
      <td><input class="cell ro d" type="text" placeholder="D" aria-label="D" readonly></td>
      <td><input class="cell ro e" type="text" placeholder="E" aria-label="E" readonly></td>
    `;
    return tr;
  }
  function ensureRows(n){
    n = Math.max(1, Math.floor(n));
    const cur = tbody.rows.length;
    if (n > cur){ for (let i=0;i<n-cur;i++) tbody.appendChild(rowEl()); }
    else if (n < cur){ for (let i=0;i<cur-n;i++) tbody.removeChild(tbody.lastElementChild); }
  }
  function recomputeRow(tr){
    const A = parseFloat(tr.querySelector('.a')?.value);
    const B = parseFloat(tr.querySelector('.b')?.value);
    const cEl = tr.querySelector('.c'), dEl = tr.querySelector('.d'), eEl = tr.querySelector('.e');
    if (isNaN(A) || isNaN(B)){ cEl.value = dEl.value = eEl.value = ""; return; }
    const {C,D,E} = compute(A,B);
    cEl.value = fmt(C); dEl.value = fmt(D); eEl.value = fmt(E);
  }

  tbody.addEventListener('input', (e)=>{
    const t = e.target;
    if (!(t instanceof HTMLInputElement)) return;
    if (t.classList.contains('a') || t.classList.contains('b')) recomputeRow(t.closest('tr'));
  });

  apply.onclick = ()=> ensureRows(parseInt(rowsInp.value||'1',10));
  clearAB.onclick = ()=> { [...tbody.querySelectorAll('.a,.b,.c,.d,.e')].forEach(el=> el.value=""); };

  /* ===== Copy helpers ===== */
  function showToast(msg="Copied!"){
    toast.textContent = msg;
    toast.classList.add('show');
    setTimeout(()=>toast.classList.remove('show'), 1400);
  }
  async function copyText(text){
    try {
      await navigator.clipboard.writeText(text);
      showToast();
    } catch {
      // Fallback
      const ta = document.createElement('textarea');
      ta.value = text; document.body.appendChild(ta);
      ta.select(); document.execCommand('copy'); ta.remove();
      showToast();
    }
  }
  function escapeCSV(s){
    if (s == null) return "";
    s = String(s);
    return /[",\n]/.test(s) ? `"${s.replace(/"/g,'""')}"` : s;
  }
  function getTableData(){
    const headers = ["Text","Model 1 (A)","Model 2 (B)","Fix1 (C)","Fix2 (D)","Fix3 (E)"];
    const rows = [];
    for (const tr of tbody.rows){
      const t = tr.querySelector('input[type="text"]')?.value ?? "";
      const a = tr.querySelector('.a')?.value ?? "";
      const b = tr.querySelector('.b')?.value ?? "";
      const c = tr.querySelector('.c')?.value ?? "";
      const d = tr.querySelector('.d')?.value ?? "";
      const e = tr.querySelector('.e')?.value ?? "";
      const allEmpty = [t,a,b,c,d,e].every(v => String(v).trim()==="");
      if (skipBlank.checked && allEmpty) continue;
      rows.push([t,a,b,c,d,e]);
    }
    return { headers, rows };
  }

  copyTSV.onclick = ()=>{
    const {headers, rows} = getTableData();
    const lines = [];
    if (includeHdr.checked) lines.push(headers.join("\t"));
    for (const r of rows) lines.push(r.join("\t"));
    copyText(lines.join("\n"));
  };

  copyCSV.onclick = ()=>{
    const {headers, rows} = getTableData();
    const lines = [];
    if (includeHdr.checked) lines.push(headers.map(escapeCSV).join(","));
    for (const r of rows) lines.push(r.map(escapeCSV).join(","));
    copyText(lines.join("\n"));
  };

  copyHTML.onclick = ()=>{
    const {headers, rows} = getTableData();
    const esc = s => String(s).replace(/[&<>"']/g, m=>({ "&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#39;" }[m]));
    let html = '<table><thead>';
    if (includeHdr.checked){
      html += '<tr>' + headers.map(h=>`<th>${esc(h)}</th>`).join('') + '</tr>';
    }
    html += '</thead><tbody>';
    for (const r of rows) html += '<tr>' + r.map(v=>`<td>${esc(v)}</td>`).join('') + '</tr>';
    html += '</tbody></table>';
    copyText(html);
  };

  /* ===== Column width drag ===== */
  let colDrag = null;
  table.addEventListener('mousedown', (e)=>{
    const handle = e.target.closest('.col-resizer');
    if (!handle) return;
    const th = handle.parentElement;
    colDrag = { startX: e.clientX, startW: th.getBoundingClientRect().width, th,
                colIndex: [...th.parentElement.children].indexOf(th) + 1 };
    document.body.classList.add('resizing');
    e.preventDefault();
  });
  window.addEventListener('mousemove', (e)=>{
    if (!colDrag) return;
    const dx = e.clientX - colDrag.startX;
    const newW = Math.max(100, Math.round(colDrag.startW + dx));
    colDrag.th.style.width = newW + 'px';
    [...table.querySelectorAll(`tbody tr td:nth-child(${colDrag.colIndex})`)]
      .forEach(td => td.style.width = newW + 'px');
  });
  window.addEventListener('mouseup', ()=>{
    if (!colDrag) return; colDrag = null; document.body.classList.remove('resizing');
  });

  /* ===== Frame edge/corner drag resize ===== */
  const frame = document.getElementById('frame');
  let frameDrag = null;
  frame.addEventListener('mousedown', (e)=>{
    const h = e.target.closest('.resize-handle');
    if (!h) return;
    frameDrag = {
      axis: h.dataset.axis,
      startX: e.clientX,
      startY: e.clientY,
      startW: frame.getBoundingClientRect().width,
      startH: frame.getBoundingClientRect().height
    };
    document.body.classList.add('resizing');
    e.preventDefault();
  });
  window.addEventListener('mousemove', (e)=>{
    if (!frameDrag) return;
    const dx = e.clientX - frameDrag.startX;
    const dy = e.clientY - frameDrag.startY;
    let w = frameDrag.startW, h = frameDrag.startH;
    if (frameDrag.axis.includes('x')) w = Math.max(480, Math.round(frameDrag.startW + dx));
    if (frameDrag.axis.includes('y')) h = Math.max(260, Math.round(frameDrag.startH + dy));
    frame.style.width  = w + 'px';
    frame.style.height = h + 'px';
  });
  window.addEventListener('mouseup', ()=>{
    if (!frameDrag) return; frameDrag = null; document.body.classList.remove('resizing');
  });

  /* Init */
  ensureRows(parseInt(rowsInp.value,10));
})();
</script>
</body>
</html>
